<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fokus-Pilot</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f7f8;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    background: #0066cc;
    color: white;
    width: 100%;
    padding: 1rem;
    text-align: center;
  }
  main {
    margin-top: 20px;
    width: 90%;
    max-width: 600px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }

  label {
    display: block;
    margin: 10px 0 5px;
  }
  select, input[type=number] {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }

  button {
    background: #0066cc;
    color: white;
    border: none;
    padding: 10px 15px;
    font-size: 1rem;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 15px;
  }
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
  }

  #cockpit {
    margin-top: 20px;
    background: #e7f0fe;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
  }

  #focusScreen {
    display: none;
    background: black;
    color:white;
    height: 300px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 3rem;
    user-select: none;
  }

  #alerts {
    color: red;
    font-weight: bold;
    margin-top: 10px;
  }

  #microBreak {
    display: none;
    margin-top: 20px;
    padding: 15px;
    background: #cce7cc;
    border-radius: 8px;
  }

  #report {
    display: none;
    margin-top: 20px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 8px;
  }

</style>
</head>
<body>
<header>
  <h1>Fokus-Pilot</h1>
</header>
<main>
  <section id="launchMission">
    <h2>1. Mulai Misi (Launch Mission)</h2>
    <label for="missionSelect">Pilih Misi:</label>
    <select id="missionSelect">
      <option value="trigonometri">Menyelesaikan Bab Trigonometri (Kesulitan: 3/5)</option>
      <option value="fisika">Menyelesaikan Soal Fisika (Kesulitan: 4/5)</option>
      <option value="kimia">Belajar Kimia Organik (Kesulitan: 2/5)</option>
    </select>

    <label for="focusTime">Atur Waktu Fokus (menit):</label>
    <input type="number" id="focusTime" min="5" max="120" value="45" />

    <label for="breakTime">Atur Waktu Istirahat (menit):</label>
    <input type="number" id="breakTime" min="1" max="30" value="10" />

    <button id="startMission">Mulai Misi</button>
  </section>

  <section id="cockpit" aria-live="polite">
    <h2>2. Konfigurasi Kokpit (Setup Cockpit)</h2>
    <p id="cockpitInfo">Atur waktu fokus dan istirahat sesuai misi.</p>
  </section>

  <section id="focusScreen">
    <h2>3. Mode Fokus Total (In-Flight Mode)</h2>
    <p>Fokus selama sesi berjalan. Jangan keluar dari kokpit!</p>
    <p id="timerDisplay">00:00</p>
    <p id="pointsDisplay">Poin Fokus: 0</p>
    <p id="alerts"></p>
  </section>

  <section id="microBreak">
    <h2>5. Micro-Break Challenge (Mendarat Sejenak)</h2>
    <p id="microBreakText"></p>
    <p>Istirahat dulu, jangan buka tab lain.</p>
  </section>

  <section id="report">
    <h2>6. Laporan Penerbangan (Mission Report)</h2>
    <p id="reportContent"></p>
  </section>
</main>

<script>

const missions = {
  trigonometri: { name: "Menyelesaikan Bab Trigonometri", difficulty: "3/5 - Berat" },
  fisika: { name: "Menyelesaikan Soal Fisika", difficulty: "4/5 - Berat" },
  kimia: { name: "Belajar Kimia Organik", difficulty: "2/5 - Sedang" }
};

const microBreaks = [
  "1 menit peregangan leher",
  "2 menit melihat keluar jendela",
  "3 menit meditasi suara alam"
];

let focusTime = 45; // menit
let breakTime = 10; // menit
let timer = null;
let breakTimer = null;
let points = 0;
let focusSeconds = 0;
let breakSeconds = 0;
let inFocus = false;
let failCount = 0;

const missionSelect = document.getElementById('missionSelect');
const focusTimeInput = document.getElementById('focusTime');
const breakTimeInput = document.getElementById('breakTime');
const startBtn = document.getElementById('startMission');
const cockpit = document.getElementById('cockpit');
const cockpitInfo = document.getElementById('cockpitInfo');
const focusScreen = document.getElementById('focusScreen');
const timerDisplay = document.getElementById('timerDisplay');
const pointsDisplay = document.getElementById('pointsDisplay');
const alerts = document.getElementById('alerts');
const microBreak = document.getElementById('microBreak');
const microBreakText = document.getElementById('microBreakText');
const report = document.getElementById('report');
const reportContent = document.getElementById('reportContent');

function formatTime(seconds) {
  const m = Math.floor(seconds / 60).toString().padStart(2, '0');
  const s = (seconds % 60).toString().padStart(2, '0');
  return ${m}:${s};
}

function updateCockpit() {
  const mission = missions[missionSelect.value];
  cockpitInfo.textContent = Misi: ${mission.name} (Kesulitan: ${mission.difficulty}), Fokus: ${focusTime} menit, Istirahat: ${breakTime} menit.;
}

missionSelect.addEventListener('change', updateCockpit);
focusTimeInput.addEventListener('change', () => {
  focusTime = parseInt(focusTimeInput.value) || 45;
  updateCockpit();
});
breakTimeInput.addEventListener('change', () => {
  breakTime = parseInt(breakTimeInput.value) || 10;
  updateCockpit();
});

startBtn.addEventListener('click', () => {
  inFocus = true;
  failCount = 0;
  points = 0;
  focusSeconds = 0;
  breakSeconds = 0;

  document.getElementById('launchMission').style.display = 'none';
  cockpit.style.display = 'none';
  report.style.display = 'none';
  microBreak.style.display = 'none';
  focusScreen.style.display = 'flex';
  alerts.textContent = '';

  // Fullscreen request for focus mode
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen();
  }

  startFocusTimer();
});

function startFocusTimer() {
  timer = setInterval(() => {
    focusSeconds++;
    points++;
    timerDisplay.textContent = formatTime(focusSeconds);
    pointsDisplay.textContent = Poin Fokus: ${points};

    if (focusSeconds >= focusTime * 60) {
      clearInterval(timer);
      startBreakTimer();
    }
  }, 1000);
}

function startBreakTimer() {
  inFocus = false;
  microBreakText.textContent = microBreaks[Math.floor(Math.random() * microBreaks.length)];
  focusScreen.style.display = 'none';
  microBreak.style.display = 'block';

  breakSeconds = 0;
  breakTimer = setInterval(() => {
    breakSeconds++;
    if (breakSeconds >= breakTime * 60) {
      clearInterval(breakTimer);
      showReport();
    }
  }, 1000);
}

function showReport() {
  microBreak.style.display = 'none';
  report.style.display = 'block';

  let badge = '';
  if (failCount === 0) badge = 'Pilot Konsisten';
  else if (failCount <= 2) badge = 'Pilot Stabil';
  else badge = 'Penyelesai Berat';

  reportContent.innerHTML = `
    Total waktu fokus: ${focusSeconds} detik<br>
    Akurasi fokus (gagal pindah tab): ${failCount} kali<br>
    Lencana Pilot: <strong>${badge}</strong>
  `;

  // Exit fullscreen
  if (document.exitFullscreen) {
    document.exitFullscreen();
  }

  // Reset for new mission
  document.getElementById('launchMission').style.display = 'block';
  cockpit.style.display = 'block';
}

// Turbulensi dan switch tab detection
window.addEventListener('blur', () => {
  if (inFocus) {
    failCount++;
    points = Math.max(points - 5, 0);
    alerts.textContent = 'Turbulensi! Jangan pindah tab, poin fokus berkurang.';
    // Alarm suara sederhana
    let audio = new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg');
    audio.play();

    setTimeout(() => { alerts.textContent = ''; }, 5000);
  }
});

updateCockpit();

</script>
</body>
</html>
